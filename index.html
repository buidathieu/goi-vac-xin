<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Includes nested dropdowns and a string formatting function</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="sample.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<table>
<thead>
  <tr>
    <th rowspan="2">TT</th>
    <th rowspan="2">PHÒNG BỆNH</th>
    <th rowspan="2">TÊN VẮC XIN</th>
    <th rowspan="2">NƯỚC SX</th>
    <th rowspan="2">ĐƠN GIÁ</th>
    <th rowspan="2">SỐ LIỀU</th>
    <th rowspan="2">THÀNH TIỀN</th>
  </tr>
  <tr>
  </tr>
</thead>
<tbody data-bind="foreach: seats">
  <tr>
    <td>1</td>
    <td>6IN1</td>
    <td><select data-bind="options: $root.availableMeals, value: meal, optionsText: 'mealName'"></select></td>
    <td data-bind="with: category">
            <select data-bind='options: 6in1, optionsText: "nsx", optionsCaption: "", value: nsx'> </select>
    </td>
    <td data-bind="text: formattedPrice"></td>
    <td>3</td>
    <td>2.985.000 đ</td>
  </tr>
  <tr>
    <td>2</td>
    <td>
            <select data-bind='options: sampleProductCategories, optionsText: "name", optionsCaption: "Select...", value: category'> </select>
        </td>
    <td data-bind="with: category">
            <select data-bind='options: phecau, optionsText: "name", optionsCaption: "Select...", value: phecau.name'> </select>
        </td>
    <td>Bỉ</td>
    <td>990.000 đ</td>
    <td>3</td>
    <td>2.970.000 đ</td>
  </tr>
  <tr>
    <td>3</td>
    <td>Rota virus</td>
    <td>Rotateq</td>
    <td>Mỹ</td>
    <td>660.000 đ</td>
    <td>3</td>
    <td>1.980.000 đ</td>
  </tr>
  <tr>
    <td>4</td>
    <td>Não mô cầu BC</td>
    <td>Mengoc BC</td>
    <td>Cuba</td>
    <td>280.000 đ</td>
    <td>2</td>
    <td>560.000 đ</td>
  </tr>
  <tr>
    <td>5</td>
    <td>Cúm</td>
    <td>Gcflu Quadrivalent</td>
    <td>Hàn Quốc</td>
    <td>330.000 đ</td>
    <td>2</td>
    <td>660.000 đ</td>
  </tr>
  <tr>
    <td>6</td>
    <td>Não mô cầu ACYW</td>
    <td>Menactra</td>
    <td>Mỹ</td>
    <td>1.245.000 đ</td>
    <td>1</td>
    <td>1.245.000 đ</td>
  </tr>
  <tr>
    <td>7</td>
    <td>Viêm não Nhật Bản</td>
    <td>Imojev</td>
    <td>Thái Lan</td>
    <td>655.000 đ</td>
    <td>1</td>
    <td>655.000 đ</td>
  </tr>
  <tr>
    <td>8</td>
    <td>Sởi - Quai bị - Rubella</td>
    <td>Priorix</td>
    <td>Bỉ</td>
    <td>400.000 đ</td>
    <td>1</td>
    <td>400.000 đ</td>
  </tr>
  <tr>
    <td>9</td>
    <td>Thủy đậu</td>
    <td>Varilrix</td>
    <td>Bỉ</td>
    <td>940.000 đ</td>
    <td>1</td>
    <td>940.000 đ</td>
  </tr>
  <tr>
    <td colspan="5">Tổng số liều:&nbsp;&nbsp;&nbsp;</td>
    <td>17</td>
    <td></td>
  </tr>
  <tr>
    <td colspan="5">Giá tiêm lẻ:</td>
    <td colspan="2">12.395.000 đ</td>
  </tr>
  <tr>
    <td colspan="5">Giá gói:</td>
    <td colspan="2">12.095.000 đ</td>
  </tr>
</tbody>
</table>
<p class='grandTotal'>
    Total value: <span data-bind='text: formatCurrency(grandTotal())'> </span>
</p>
<button data-bind='click: addLine'>Add product</button>
<button data-bind='click: save'>Submit order</button>

<script>

   // Class to represent a row in the seat reservations grid
function SeatReservation(name, initialMeal) {
    var self = this;
    self.name = name;
    self.meal = ko.observable(initialMeal);

    self.formattedPrice = ko.computed(function() {
        var price = self.meal().price;
        return price ? "$" + price.toFixed(2) : "None";        
    });    
}

// Overall viewmodel for this screen, along with initial state
function ReservationsViewModel() {
    var self = this;

    // Non-editable catalog data - would come from the server
    self.availableMeals = [
        { mealName: "Hexaxim", price: 995.000 },
        { mealName: "Synflorix", price: 1000.000 },
        { mealName: "Ultimate (whole zebra)", price: 290 }
    ];    

    // Editable data
    self.seats = ko.observableArray([
        new SeatReservation("Steve", self.availableMeals[0]),
        new SeatReservation("Bert", self.availableMeals[0])
    ]);

    // Computed data
    self.totalSurcharge = ko.computed(function() {
       var total = 0;
       for (var i = 0; i < self.seats().length; i++)
           total += self.seats()[i].meal().price;
       return total;
    });    

    // Operations
    self.addSeat = function() {
        self.seats.push(new SeatReservation("", self.availableMeals[0]));
    }
    self.removeSeat = function(seat) { self.seats.remove(seat) }
}

ko.applyBindings(new ReservationsViewModel());

</script>
</body>
</html>
